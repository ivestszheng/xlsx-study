## 需求

- 提供一个 Excel 文件，将里面的内容转成 JSON 导入数据
- 提供一个 JSON 文件，生成 Excel 文件并导出

> 导入与导出既可以前端做，也可以后端做。本文主要探讨前端通过`SheetJS/js-xlsx`这个库实现 Excel 导入、导出功能。

## 基础知识

新建一个 Excel 文档，这个文档就是`Workbook`，而一个`Workbook` 下可以有多个`sheet`。

## 技术选型

市面上的报表类产品大抵可以分为以下两种：

1. 云文档类型产品
2. 控件类型产品

像 SheetJS/js-xlsx、LuckySheet、Handsontable、SpreadJS 都是标准的纯前端表格控件且都支持 Excel 的功能特性和 JSON 数据绑定。

最后选择 SheetJS/js-xlsx 这个库主要因为以下两个原因：

1. 社区版开源免费。也可选择性能增强的专业版，专业版提供样式和专业支持的附加功能。
2. 有 30k star，维护频率高，笔者在写这篇文章时（5 月 10 日）该项目的上一次提交在 5 月 9 日。

## SheetJS/js-xlsx

### 安装

```
$ yarn add xlsx@0.16.9
$ npm i xlsx@0.16.9
```

建议跟上版本号，我第一次装的时候没跟上版本号没有安装成功。

### 常用的数据表格式(Common Spreadsheet Format)

`js-xlsx`符合常用的数据表格式(CSF)。

#### 一般结构

单元格地址对象的存储格式为`{c:C, r:R}`，其中`C`和`R`分别代表的是 0 索引列和行号。例如单元格地址`B5`用对象`{c:1, r:4}`表示。

单元格范围对象存储格式为`{s:S, e:E}`，其中`S`是第一个单元格，`E`是最后一个单元格。范围是包含关系。例如范围 `A3:B7`用对象`{s:{c:0, r:2}, e:{c:1, r:6}}`表示。

#### 单元格对象

单元格对象是纯粹的 JS 对象，它的 keys 和 values 遵循下列的约定：

| Key | Description                                                            |
| --- | ---------------------------------------------------------------------- |
| `v` | 原始值(查看数据类型部分获取更多的信息)                                 |
| `w` | 格式化文本(如果可以使用)                                               |
| `t` | 内行: `b` Boolean, `e` Error, `n` Number, `d` Date, `s` Text, `z` Stub |
| `f` | 单元格公式编码为 A1 样式的字符串(如果可以使用)                         |
| `F` | 如果公式是数组公式，则包围数组的范围(如果可以使用)                     |
| `r` | 富文本编码 (如果可以使用)                                              |
| `h` | 富文本渲染成 HTML (如果可以使用)                                       |
| `c` | 与单元格关联的注释                                                     |
| `z` | 与单元格关联的数字格式字符串(如果有必要)                               |
| `l` | 单元格的超链接对象 (`.Target` 长联接, `.Tooltip` 是提示消息)           |
| `s` | 单元格的样式/主题 (如果可以使用)                                       |

如果`w`文本可以使用，内置的导出工具(比如 CSV 导出方法)就会使用它。要想改变单元格的值，在打算导出之前确保删除`cell.w`(或者设置 `cell.w`为`undefined`)。工具函数会根据数字格式(`cell.z`)和原始值(如果可用)重新生成`w`文本。

真实的数组公式存储在数组范围中第一个单元个的`f`字段内。此范围内的其他单元格会省略`f`字段。

> 更多详细信息请查看[文档](https://github.com/SheetJS/sheetjs/blob/master/README.md)

## 前端导入 Excel 数据

## 前端导出 Excel 文件

## 参考

1. [掘金：数据可视化探索之 SpreadJS](https://juejin.cn/post/6955998176549535758)
2. [掘金：如何基于 AntV S2 打造大数据表格组件](https://juejin.cn/post/7072926133859123236)
3. [掘金：十分钟上手 xlsx，4 种方法实现 Excel 导入导出](https://juejin.cn/post/6998000575203770376#heading-6)
